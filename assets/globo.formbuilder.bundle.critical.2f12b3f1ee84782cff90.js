"use strict";(self.webpackChunkgloboFormbuilder=self.webpackChunkgloboFormbuilder||[]).push([[122],{4104:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});const o=r(9765),a={handleValidate:function(e){const t=this,r=e.querySelector(".block-container");if(!r)return;let a={};r.querySelectorAll("input, textarea, select").forEach((t=>{const o=null!==t.getAttribute("presence"),s=null!==t.getAttribute("disabled"),i=null!==t.getAttribute("data-type")&&t.getAttribute("data-type");if(a[t.name]={},s?a[t.name].ignore={}:o&&("products[]"==t.name?a[t.name].presence={message:this.forms[r.getAttribute("data-id")].errorMessage.requiredProducts}:a[t.name].presence={message:this.forms[r.getAttribute("data-id")].errorMessage.required}),"email"==i&&(a[t.name][i]={message:this.forms[r.getAttribute("data-id")].errorMessage.invalidEmail}),"name"==i&&(a[t.name].format={pattern:"^[ -.A-ï¿œ]+",flags:"s",message:this.forms[r.getAttribute("data-id")].errorMessage.invalidName}),"url"==i&&(a[t.name][i]={message:this.forms[r.getAttribute("data-id")].errorMessage.invalidURL}),"phone"==i&&(null!==t.getAttribute("validate")?null===t.getAttribute("onlyshowflag")&&(a[t.name].phone={message:this.forms[r.getAttribute("data-id")].errorMessage.invalidPhone}):a[t.name].format={pattern:"^[+]*[(]{0,1}[0-9+]{1,9}[)]{0,1}[-s.0-9 ]*$",flags:"i",message:this.forms[r.getAttribute("data-id")].errorMessage.invalidPhone}),"file"==i){const e=!1!==this.shop.pricing.features.fileUpload?1024*this.shop.pricing.features.fileUpload:2048;a[t.name][i]={notAllowedExtension:this.forms[r.getAttribute("data-id")].errorMessage.fileNotAllowed,sizeLimitMessage:this.forms[r.getAttribute("data-id")].errorMessage.fileSizeLimit,allowedExtension:t.getAttribute("data-allowed-extensions").split(","),maxFileSize:e}}if("checkbox"==i&&(a[t.name][i]={requiredMessage:this.forms[e.getAttribute("data-id")].errorMessage.required},a[t.name][i].isRequired=void 0!==a[t.name].presence),"password"==i){const e=null!==t.getAttribute("data-additional-type")&&t.getAttribute("data-additional-type"),o=null!==t.getAttribute("data-connected-element")&&t.getAttribute("data-connected-element");"confirm-password"===e&&o&&(a[t.name].equality={attribute:o,message:this.forms[r.getAttribute("data-id")].errorMessage.confirmPasswordNotMatch});let s=!(!t.getAttribute("data-validate-rule")||"false"==t.getAttribute("data-validate-rule"))&&t.getAttribute("data-validate-rule");s&&("advancedValidateRule"===s&&(s=null!==t.getAttribute("data-validate-rule")?t.getAttribute("data-advanced-validate-rule"):""),a[t.name].format={pattern:s,flags:"g",message:this.forms[r.getAttribute("data-id")].errorMessage.invalidPassword})}}));null!=e.querySelector(".block-container .globo-g-recaptcha")&&(a.reCaptcha={reCaptcha:{isRequired:!0,requiredMessage:this.forms[r.getAttribute("data-id")].errorMessage.requiredCaptcha}}),o.validators.file=function(t,r,o){const a=e.querySelector('[name="'+o+'"]');let s=0,i=!0;return Array.from(a.files).forEach((e=>{s+=e.size,-1===r.allowedExtension.indexOf(function(e){const t=e.split("\\").pop().split("/").pop(),r=t.lastIndexOf(".");return r<1?"":t.substr(r+1)}(e.name).toLowerCase())&&(i=!1)})),s/1e3>r.maxFileSize?r.sizeLimitMessage:i?null:r.notAllowedExtension},o.validators.checkbox=function(t,r,o,a){if(!r.isRequired)return null;const s=e.querySelectorAll("[name='"+o+"']");let i=!1;return s.forEach((e=>{e.checked&&(i=!0)})),i?null:r.requiredMessage},o.validators.reCaptcha=function(t,r,o,a){const s=e.querySelector("[name='"+o+"']");if(s){const e=grecaptcha.getResponse(s.getAttribute("reCaptcha-widget-id"));return s.value=e,""!=s.value?null:r.requiredMessage}return null},o.validators.ignore=function(){return null},o.validators.phone=function(o,a,s,i){const l=e.querySelectorAll("[name='"+s+"'][validate]");let n=!0;return l&&l.forEach((e=>{const o=e.getAttribute("data-intl-id"),a=t.phoneIntl[r.getAttribute("data-id")][s+"-"+o];if(void 0!==a&&e.value.trim()&&!a.isValidNumber()){const e=a.getValidationError();console.log("Phone validate ",0==e?"IS_POSSIBLE":1==e?"INVALID_COUNTRY_CODE":2==e?"TOO_SHORT":3==e?"TOO_LONG":4==e?"IS_POSSIBLE_LOCAL_ONLY":"INVALID_LENGTH"),n=!1}})),n?null:a.message};const s=o(r,a,{fullMessages:!1});!function(e,t){let r=!1;e.querySelectorAll("input[name], select[name], textarea[name]").forEach((e=>{if(n(e,t&&t[e.name]),!r&&t[e.name]){const t=d(e,"globo-form-control");t&&(Globo.FormBuilder.scrollIntoErrorGroup(t),r=!0)}}))}(r,s||{}),s&&Object.keys(s).length?r.classList.add("errors"):r.classList.remove("errors");const i=r.querySelectorAll("input:not(.item__quantity):not(.action--add-to-cart), textarea, select");for(var l=0;l<i.length;++l)i.item(l).addEventListener("change",(function(e){const t=o(r,a,{fullMessages:!1})||{};Object.keys(t).length?r.classList.add("errors"):r.classList.remove("errors"),n(this,t[this.name])}));function n(e,t){const r=d(e.parentNode,"globo-form-control"),o=r.querySelector(".messages");!function(e){e.classList.remove("has-error"),e.classList.remove("has-success"),e.querySelectorAll(".help-block.error").forEach((e=>{e.parentNode.removeChild(e)}))}(r),t?(r.classList.add("has-error"),t.forEach((e=>{!function(e,t){const r=document.createElement("p");r.classList.add("help-block"),r.classList.add("error"),r.innerText=t,e.appendChild(r)}(o,e)}))):r.classList.add("has-success")}function d(e,t){return e&&e!=document?e.classList.contains(t)?e:d(e.parentNode,t):null}},scrollIntoErrorGroup:function(e){e.scrollIntoView({behavior:"smooth",block:"nearest"})}},s={handleSubmit:function(e){e.preventDefault(),e.stopPropagation(),Globo.FormBuilder.handleValidate(e.target);const t=new CustomEvent("globo.formbuilder.form.beforeSubmit",{detail:{form:e.target,formId:e.target.getAttribute("data-id")}});document.dispatchEvent(t);if(e.target.querySelector(".block-container.errors"))return;const r=new CustomEvent("globo.formbuilder.form.submitting",{detail:{form:e.target,formId:e.target.getAttribute("data-id")}});document.dispatchEvent(r);var o=e.target.querySelector(".action.submit");o.classList.add("loading"),o.setAttribute("disabled","disabled");let a=e.target.closest(".globo-form-app").querySelectorAll(".message.success");var s=e.target.querySelectorAll("input, textarea, select"),i={"{{customer.name}}":Globo.FormBuilder.customer?Globo.FormBuilder.customer.name:"","{{customer.email}}":Globo.FormBuilder.customer?Globo.FormBuilder.customer.email:"","{{page.title}}":Globo.FormBuilder.page?Globo.FormBuilder.page.title:"","{{page.href}}":Globo.FormBuilder.page?Globo.FormBuilder.page.href:""};a.forEach((function(e){e.innerHTML=Globo.FormBuilder.addVariables(e.innerHTML,i,s)}));const l=e.target.querySelectorAll('[type="hidden"]');l&&l.forEach((function(e){if(e.value.indexOf("{{-")>-1&&e.value.indexOf("-}}")>-1){const t=e.value.replace("{{-","").replace("-}}","").trim().split(".");e.value=void 0!==Globo.FormBuilder[t[0]]&&void 0!==Globo.FormBuilder[t[0]][t[1]]?Globo.FormBuilder[t[0]][t[1]]:""}}));let n=[];const d=e.target.querySelectorAll(".action--add-to-cart"),u=Globo.FormBuilder.bulkOrder;let c=[];d.length&&d.forEach((e=>{e.checked&&(c=u.addItems(c,e))})),c.length&&void 0!==Globo.FormBuilder.page&&n.push(u.addProducts(c,e.target)),n.push(Globo.FormBuilder.xhr(e.target)),Promise.all(n).then((t=>{o.classList.remove("loading"),o.removeAttribute("disabled"),e.target.querySelectorAll(".message").forEach((function(e){e.style.display="none"}));let r="",a="";if(t.map((e=>{e?.items||"Cart Error"==e?.message?r=e:a=e})),"true"==a.success){const o=new CustomEvent("globo.formbuilder.form.submitted",{detail:{form:e.target,formId:e.target.getAttribute("data-id"),response:t}});if(document.dispatchEvent(o),void 0!==r.items){const o=Globo.FormBuilder.forms[e.target.getAttribute("data-id")].elements.find((e=>e.id="products"));o.successMessage&&e.target.querySelectorAll(".message.success").forEach((function(e){e.querySelector(".content").insertAdjacentHTML("beforebegin","<h4>"+o.successMessage+"</h4></br>")}));var l=new CustomEvent("globo.formbuilder.bulkorder.added",{detail:{form:e.target,formId:e.target.getAttribute("data-id"),response:t,cartItem:r.items}});document.dispatchEvent(l)}else if("Cart Error"==r.message){e.target.querySelector(".message.warning .content").innerHTML=r.description}const a=Globo.FormBuilder.forms[e.target.getAttribute("data-id")].afterSubmit;if("undefined"!=typeof ga&&a.enableGa){const e=Globo.FormBuilder.addVariables(a.gaEventCategory,i,s)||"",t=Globo.FormBuilder.addVariables(a.gaEventAction,i,s)||"",r=Globo.FormBuilder.addVariables(a.gaEventLabel,i,s)||"";ga("send",{hitType:"event",eventCategory:e,eventAction:t,eventLabel:r})}if("function"==typeof fbq&&a.enableFpx){const t=Globo.FormBuilder.addVariables(a.fpxTrackerName,i,s)||"GloboFormBuilder-Submit";fbq("trackCustom",t,{pageTitle:Globo.FormBuilder.page.title,pageHref:Globo.FormBuilder.page.href,formTitle:Globo.FormBuilder.forms[e.target.getAttribute("data-id")].header.title})}if(void 0!==Globo.FormBuilder.utm.view&&"formbuilder_edit"===Globo.FormBuilder.utm.view||"redirectToPage"!=a.action||window.setTimeout((function(){window.location.href=a.redirectUrl}),"undefined"!=typeof ga&&a.enableGa||"function"==typeof fbq&&a.enableFpx?1500:100),"clearForm"==a.action){(void 0===Globo.FormBuilder.utm.view||"formbuilder_edit"!==Globo.FormBuilder.utm.view)&&e.target.reset(),Globo.FormBuilder.showMessage(e.target.querySelector(".message.success")),Globo.FormBuilder.showMessage(e.target.querySelector(".message.warning")),void 0!==r.items&&Globo.FormBuilder.renderForm(e.target,e.target.getAttribute("data-id"),[{success:e.target.querySelector(".message.success").outerHTML}]);const{functions:t}=Globo.FormBuilder.forms[e.target.getAttribute("data-id")];t.includes("reCaptcha")&&Globo.FormBuilder.reCaptcha.resetReCaptcha(e);const o=e.target.querySelector(".globo-formbuilder-wizard");if(o){new Globo.FormBuilder.Wizard(e.target.closest(".globo-formbuilder"),o).reset()}}if("hideForm"==a.action){void 0!==Globo.FormBuilder.utm.view&&"formbuilder_edit"===Globo.FormBuilder.utm.view||(e.target.style.display="none");const t=e.target.parentNode.querySelectorAll(".message.success");t&&Globo.FormBuilder.showMessage(t[t.length-1]),Globo.FormBuilder.showMessage(e.target.querySelector(".message.warning"))}}else{const o=e.target.querySelector(".message.error .content"),s=void 0!==a.errors&&a.errors;if(s){let a="";for(var n=0;n<Object.keys(s).length;n++)if("string"==typeof s[n])a+='<div class="err-item"><span class="label"></span><span class="err">'+s[n]+"</span></div>";else{let t=e.target.querySelector('[name="_keyLabel"]');t&&(t=JSON.parse(t.value)),void 0!==t[Object.keys(s)[n]]?a+='<div class="err-item"><span class="label">'+t[Object.keys(s)[n]]+'</span> : <span class="err">'+s[Object.keys(s)[n]]+"</span></div>":a+='<div class="err-item"><span class="label"></span><span class="err">'+s[Object.keys(s)[n]]+"</span></div>"}if(void 0!==r.items){const o=Globo.FormBuilder.forms[e.target.getAttribute("data-id")].elements.find((e=>e.id="products"));e.target.querySelectorAll(".message.success").forEach((function(e){e.querySelector(".content").innerHTML="<h4>"+o.successMessage+"</h4></br>"})),Globo.FormBuilder.showMessage(e.target.querySelector(".message.success"));l=new CustomEvent("globo.formbuilder.bulkorder.added",{detail:{form:e.target,formId:e.target.getAttribute("data-id"),response:t,cartItem:r.items}});document.dispatchEvent(l)}else if("Cart Error"==r.message){e.target.querySelector(".message.warning .content").innerHTML=r.description,Globo.FormBuilder.showMessage(e.target.querySelector(".message.warning"))}o.innerHTML=a;const{functions:i}=Globo.FormBuilder.forms[e.target.getAttribute("data-id")];i.includes("reCaptcha")&&Globo.FormBuilder.reCaptcha.resetReCaptcha(e)}Globo.FormBuilder.showMessage(e.target.querySelector(".message.error"));const i=[{success:e.target.querySelector(".message.success").outerHTML},{error:e.target.querySelector(".message.error").outerHTML}];void 0!==r.items&&void 0!==Globo.FormBuilder.page&&Globo.FormBuilder.renderForm(e.target,e.target.getAttribute("data-id"),i)}}))},xhr:function(e){const t=e.getAttribute("action"),r=e.getAttribute("method"),o=e.querySelector(".block-container").getAttribute("data-id");let a=new FormData(e);const s=new FormData;let i,l=0;void 0!==a.fd&&(a=a.fd);for(const t of a)if(t[0].includes("select_product")){t[0]!==i&&(i=t[0],l=0);const r=JSON.parse(e.querySelector(`[name="${t[0]}"][value="${t[1]}"]`).nextElementSibling.innerHTML);s.append(t[0]+`[${l}][url]`,`https://${this.shop.url}/admin/products/${r.id}`),s.append(t[0]+`[${l}][name]`,r.title),l++}else{if(t[0].indexOf("products")>-1){const r=e.querySelector('.item__quantity[data-variant-id="'+t[1]+'"]');if(r){const e=t[0].split("-").length>1?`quantities-${t[0].split("-")[1]}`:"quantities[]";s.append(e,t[1]+" / "+r.value)}}if(t[0].indexOf("phone")>-1&&void 0!==this.phoneIntl&&void 0!==this.phoneIntl[o]){let r=e.querySelector('[name="'+t[0]+'"]').getAttribute("data-intl-id");void 0!==this.phoneIntl[o][t[0]+"-"+r]&&(t[1]=this.phoneIntl[o][t[0]+"-"+r].getNumber())}s.append(t[0],t[1])}return new Promise(((o,a)=>{o(fetch(t,{method:r,body:s}).then((function(e){if(e.ok)return e.json();{const t=new Error(e.statusText);throw t.response=e,t}})).then((e=>e)).catch((t=>{e.querySelector(".action.submit").classList.remove("loading");const r=e.querySelector(".message.error"),o=r.getAttribute("data-other-error"),a=e.querySelector(".message.error");a&&(a.innerHTML='<div class="err-item"><span class="label"></span><span class="err">'+(o||"Too many request, please try again later")+"</span></div>"),r&&this.showMessage(r)})))}))}},i=r(6808),l={...a,...s,showMessage:function(e){if(e){var t=e.querySelector(".content");null!==t&&""!=t.innerHTML&&(e.style.display="block")}},handleResetForm:function(e){const t=e.closest(".globo-formbuilder");if(t){const e=t.querySelectorAll(".globo-form-control [name]:not([type='file']):not([type='hidden'][data-type='fixed'])");e&&e.forEach((function(e){const t=e.closest(".globo-form-control");!t||null!=t.getAttribute("data-default-value")&&""!=t.getAttribute("data-default-value")&&","!=t.getAttribute("data-default-value")&&"\\"!=t.getAttribute("data-default-value")||("checkbox"==e.type||"radio"==e.type?e.checked=!1:e.value="")}));const r=t.querySelector(".globo-formbuilder-wizard");if(r){new this.Wizard(t,r).reset()}this.handleHiddenField(this.forms[t.getAttribute("data-id")],t)}},dismiss:function(e){e.parentNode.style.display="none";var t=e.closest(".message");if(t.classList.contains("success")){var r=e.closest(".g-container");t.innerHTML=Globo.FormBuilder.forms[r.getAttribute("data-id")].afterSubmit.message}},addVariables:function(e,t,r){var o=[];return e=e.replace(/{{customer.name}}|{{customer.email}}|{{page.title}}|{{page.href}}/g,(function(e){return t[e]})),r.length&&r.forEach((t=>{const r="checkbox"===t.type||"file"===t.type&&t.multiple?t.name.split("[")[0]:t.name;e.indexOf("{{"+r+"}}")>-1&&("radio"===t.type?e=e.replace("{{"+t.name+"}}",t.closest(".globo-form-control").querySelector("[name="+t.name+"]:checked")?t.closest(".globo-form-control").querySelector("[name="+t.name+"]:checked").value:""):"checkbox"===t.type?(o[r]=void 0!==o[r]?o[r]:[],t.checked&&o[r].push(t.value)):"file"===t.type?t.multiple?(o[r]=void 0!==o[r]?o[r]:[],t.files.length&&Object.values(t.files).map((e=>{o[r].push(e.name)}))):e=e.replace("{{"+t.name+"}}",t.value?t.value.split("fakepath\\")[1]:""):e=e.replace("{{"+t.name+"}}",t.value))})),Object.keys(o).length>0&&Object.entries(o).map((t=>{e.indexOf("{{"+t[0]+"}}")>-1&&(e=e.replace("{{"+t[0]+"}}",t[1]))})),e},closeModalForm:function(e){const t=e.closest(".globo-form-publish-modal");if(t.style.display="none",t.classList.contains("lightbox")){const e=this.forms[t.querySelector(".globo-formbuilder").getAttribute("data-id")].publish;switch(e.selectTime){case"none":var r=0;break;case"weeks":r=void 0!==e.setCookieWeeks?7*parseInt(e.setCookieWeeks):7;break;case"days":r=void 0!==e.setCookie?parseInt(e.setCookie):1;break;case"hours":r=void 0!==e.setCookieHours?parseInt(e.setCookieHours)/12:1/12;break;default:r=365}i.set("globo-form-lightbox-"+t.getAttribute("data-id"),r,{expires:r})}}}}}]);